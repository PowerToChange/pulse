
<%= stylesheet_link_tag "jquery-ui" %>

<%= javascript_include_tag "jquery.tooltip.js" %>
<%= javascript_include_tag "timetable.js" %>


<h4 class="title">Compare Timetables</h4>


<div class="horizTableCompare timeControlsContainer">
  <% form_for @group do |form| %>
    <div class="timeControl">
      Day: <%= form.select :day, Date::DAYNAMES.zip([0,1,2,3,4,5,6]), :include_blank => true %>
    </div>
    <div class="timeControl">
      Start time: <%= form.select :start_time, times(Timetable::EARLIEST, Timetable::LATEST), :include_blank => true %>
    </div>
    <div class="timeControl">
      End time: <%= form.select :end_time, times(Timetable::EARLIEST, Timetable::LATEST), :include_blank => true %>
    </div>
    <div class="timeControl"><%= submit_tag 'Save', :class => 'action-button' %></div>
  <% end %>
</div>


<br/>


<% day_width = 14.285 %>
<% interval_width = 3.125 %>


<div id="horizTableCompareContainer" class="horizTableCompare">
  <div class="namesList">
    <%= render :partial => "compare_timetables_fancy_horizontal_person_name", :collection => @people, :as => :person, :locals => {:has_table => true} %>
    <%= render :partial => "compare_timetables_fancy_horizontal_person_name", :collection => @people_without_table, :as => :person, :locals => {:has_table => false} %>
    <%= "<div class='noTable'>* has not submitted their timetable</div>" if @people_without_table.present? %>
  </div>

  <div class="cursorHoverLine"></div>
  
  <div class="frame">

    <div class="tableContainer">
      <div class="timelineHeaderContainer timelineHeader">
        <div class="timesContainer">
          <% Date::DAYNAMES.each_with_index do |day, di| %>
            <div class="day dayHeader <%=day.downcase%>" style="width:<%=day_width%>%;">
              <div class="dayName"><%=day%></div>

              <% time = Time.now.beginning_of_day + Timetable::EARLIEST %>
              <% end_time = Time.now.beginning_of_day + Timetable::LATEST %>

              <% i=0 %>
              <% while time < end_time %>
                <div class="time timeHeader <%=time_header_zoom_class(time)%> hour<%=time.hour%>" style="left:<%=interval_width*i%>%;">
                  <%= time_header_text(time) %>
                </div>

                <div class="line <%=time_header_zoom_class(time)%>" style="left:<%=interval_width*i%>%;"></div>

                <div class="timeTooltip" style="left:<%=interval_width*i%>%; width:<%=interval_width%>%;" title="<%=time_header_text(time)%> - <%=day%>"></div>
                
                <% time += Timetable::INTERVAL %>
                <% i+=1 %>
              <% end %>
            </div>
            <div class="dayBackground <%=day.downcase%>" style="left:<%=day_width*di%>%; width:<%=day_width%>%;"></div>
          <% end %>
        </div>
      </div>

      <div class="rows">
        <%= render :partial => "compare_timetables_fancy_horizontal_person_row", :collection => @people, :as => :person, :locals => {:day_width => day_width, :interval_width => interval_width} %>
      </div>
    </div>

  </div>

  <div class="frameControls">
    <div class="zoomSliderContainer">
      <%= image_tag "silk/zoom_out.png" %><div id="zoomSlider"></div><%= image_tag "silk/zoom_in.png" %>
    </div>
  </div>
  
</div>



<script>

	$(function() {
		$("#zoomSlider").slider({min:95, max:2000, step: 3, value:$(".horizTableCompare .tableContainer").width()});
	});
  $("#zoomSlider").bind( "slide", function(event, ui) {
    $(".horizTableCompare .tableContainer").width(ui.value + "%");
    zoom_adjustments($(".horizTableCompare .tableContainer").width());
  });

  $(".timeTooltip").tooltip({
    track: true,
    delay: 0,
    showURL: false,
    showBody: " - ",
    fade: 0,
    extraClass: "horizTableCompare"
  });

  $(".frame").hover(
    function (e) {
      $(".cursorHoverLine").height($(".rows").height());
      $(".cursorHoverLine").show();
    },
    function (e) {
      $(".cursorHoverLine").hide();
    }
  );
  $(".frame").mousemove(function(e){
    $(".cursorHoverLine").css( { "left": (e.pageX - $("#horizTableCompareContainer").offset().left) + "px" } );
  });

</script>
