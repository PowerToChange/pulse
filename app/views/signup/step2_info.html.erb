
<% if session[:from_facebook_canvas] == true %>
<script type="text/javascript">
  function facebook_init_callback() {
  }

  function facebook_login_callback(session) {
    FB.api('/me', function(response) {
      setValueIfNotSetButPresent('person_first_name', response.first_name);
      setValueIfNotSetButPresent('person_last_name', response.last_name);
      setValueIfNotSetButPresent('person_email', response.email);
      setValueIfNotSetButPresent('person_local_phone', response.mobile_phone);

      // don't confuse gender index with the value
      if(response.gender == "male") {
        document.getElementById('person_gender').selectedIndex = 0;
      } else if(response.gender == "female") {
        document.getElementById('person_gender').selectedIndex = 1;
      }
    });
  }
</script>
<% end %>


<% instruction_block do %>
  We'd like to know a bit about you!
  <% if logged_in? %><br/><b>Please note that youâ€™re currently logged into The Pulse as <%= @person.full_name %>.</b>
    If this is not you
    <% if session[:from_facebook_canvas] == true %>
      <%= link_to "click here to logout.", :onclick => "top.location.href='/leave_facebook_and_js_redirect?js_redirect_url=#{logout_url}'" %>
    <% else %>
      <%= link_to "click here to logout.", logout_url %>
    <% end %>
  <% end %>
<% end %>


<div id="signup_step1_columns">

<%- form_for @person, :url => { :action => :step2_info_submit, :method => :post } do |f| -%>
  <%= f.error_messages %>
  <table id="signup_step2_info">
  <tr>
    <td class="label">First Name </td>
    <td><%= f.text_field :first_name %> </td>
  </tr>
  <tr>
    <td class="label">Last Name </td>
    <td><%= f.text_field :last_name %> </td>
  </tr>
  <%- unless logged_in? || @person.email.present? %>
  <tr>
    <td class="label">Email </td>
    <td><%= f.text_field :email %></td>
  </tr>
  <%- end %>
  <tr>
    <td class="label">Gender </td>
    <td><%= f.select :gender, [["Male", "1"], ["Female", "0"]], :selected => @person.gender_us_id, :prompt => "" %> </td>
  </tr>
  <tr>
    <td class="label">Phone </td>
    <td><%= f.text_field :local_phone %> </td>
  </tr>
  <tr>
    <td class="label">School Year </td>
    <td>
      <%= select_tag "primary_campus_involvement_school_year_id", 
            options_for_select(school_year_options),
            :name => "primary_campus_involvement[school_year_id]"
      %>
    </td>
  </tr>
  <tr>
    <td class="label">Major </td>
    <td><%= f.text_field :major %></td>
  </tr>
  <%= render :partial => "dorm_tr" %>
  </table>

</div>

<br/>

<div class="center">
  <%= submit_tag("#{@next_button_text.present? ? @next_button_text : 'Next'}", :class => 'action-button') %>
</div>

<%- end -%>
