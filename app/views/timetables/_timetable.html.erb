<table id="schedule_header" width="250px" cellspacing="0" style="display:none">
  <thead>
    <tr>
      <th>&nbsp;</th>
      <%- 7.times do |day| -%>
        <th><%= Date::DAYNAMES[day] %></th>
      <%- end -%>
  </thead>
</table>
<script>
  function findPos(obj) {
    var curleft = curtop = 0;
    if (obj.offsetParent) {
      do {
        curleft += obj.offsetLeft;
        curtop += obj.offsetTop;
      } while (obj = obj.offsetParent);
    }
    return [ curleft, curtop ];
  }

  schedLeft = schedTop = 0;

  $(document).ready(function() {
    console.log($('#schedule').width());
    $('#schedule_header').width($('#schedule').width() + "px");
    [ schedLeft, schedTop ] = findPos($('#schedule')[0]);
    $('#schedule_header').css('left', schedLeft);
  });

  function scrollTop() {
    return filterResults (
    window.pageYOffset ? window.pageYOffset : 0,
    document.documentElement ? document.documentElement.scrollTop : 0,
    document.body ? document.body.scrollTop : 0
    );
  }

  function filterResults(n_win, n_docel, n_body) {
    var n_result = n_win ? n_win : 0;
    if (n_docel && (!n_result || (n_result > n_docel)))
    n_result = n_docel;
    return n_body && (!n_result || (n_result > n_body)) ? n_body : n_result;
  }

  $(window).scroll(function() { 
    console.log(scrollTop());
    if (scrollTop() > schedTop) {
      $("#schedule_header").appear();
    } else {
      $("#schedule_header").fade();
    }
  });
</script>

 <table id="schedule" cellspacing="0">
  <thead>
    <tr>
      <th>&nbsp;</th>
      <%- 7.times do |day| -%>
        <th><%= Date::DAYNAMES[day] %></th>
      <%- end -%>
  </thead>
  <tbody>
    <!-- EARLIEST to LATEST in 15 minute intervals -->
    <%- midnight = Time.now.beginning_of_day
        time = midnight + Timetable::EARLIEST 
        stop = midnight + Timetable::LATEST 
    -%>
    <%- while time < stop 
        time_in_seconds = time.to_i - midnight.to_i -%>
      <tr>
        <td width="10px" class="time"><%= time.to_s(:time) %></td>
        <%- 7.times do |day| -%>
        <%- css_class = (@free_times[day] && @free_times[day][time_in_seconds] ? @free_times[day][time_in_seconds] : '') -%>
        <td width="50px" height="10px" class="day_<%= day %> <%= css_class.present? ? css_class : 'good' %>">
          &nbsp;
          <%= hidden_field_tag("time_#{time.to_i}", time_in_seconds) %>
        </td>
        <%- end -%>
      </tr>
      <%- time += Timetable::INTERVAL -%>
    <%- end -%>
  <tbody>
</table>    
