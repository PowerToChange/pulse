<a name="top"><h1 id="statsTitle">Statistics</h1></a>
<div class="backLink"><a href="/stats">Go back</a></div>

<br/>

<div class="statsFormContainer">
  <div class="statsFormBox">
    <h2 class="statsFormBoxTitle">Semester at a glance</h2>
    <br/>

    <% form_for :report, :url => { :action => :semester_at_a_glance }, :html => { :name => 'reportForm', :onSubmit => "$('#spinnersubmit').show()" } do |form| %>

      <p class="statsFormField">
        <%= form.label :ministry, "Ministry:" %>
        <%= form.collection_select :ministry, @ministries, :id, :name, :selected => @ministry_id.to_i %>
        <%= observe_field 'report_ministry', :url => {:action => 'campuses_collection_select'},
                                             :with => 'ministry',
                                             :update => 'campusesSelect',
                                             :before => "document.reportForm.commit.disabled=true; $('#report_campus_id').hide(); $('#spinnercampus').show()",
                                             :complete => "$('#report_campus_id').show(); $('#spinnercampus').hide(); document.reportForm.commit.disabled=false" %>
      </p>
      <p class="statsFormField">
        <%= form.label :campus_id, "Campus:" %>

        <% javascript_tag do %>
          $(document).ready(function() {
            ministry_select = document.getElementById('report_ministry')
            ministry_id = ministry_select.options[ministry_select.selectedIndex].value;

            <%= remote_function(:update => "campusesSelect",
                                :with => "'ministry=' + ministry_id + '&campus_id=' + #{@campus_id}",
                                :url => url_for(:controller => "stats", :action => "campuses_collection_select"),
                                :before => "document.reportForm.commit.disabled=true; $('#report_campus_id').hide(); $('#spinnercampus').show()",
                                :complete => "$('#report_campus_id').show(); $('#spinnercampus').hide(); document.reportForm.commit.disabled=false") %>
          });
        <% end %>

        <span id="campusesSelect"></span>
        <span class="statsSpinner"><%= spinner('campus') %></span>
      </p>
      <p class="statsFormField">
        <%= form.label :semester, "Semester:" %>
        <%= form.select :semester, @semesters, :selected => @semester_selected %>
      </p>
      <br/>
      <p>
        <%= submit_tag "Show report" , :class => "submit", :disabled => true %>
      </p>
      <%= spinner('submit') %>
    <% end %>

  </div>
</div>


<div id="results" class="statsContainer" <% unless @staff_hash.present? %> style="display: none"<% end %> >
  <% if @staff_hash.present? %>

    <% @campuses_selected.each do |campus| %>

      <% @staff = @staff_hash[campus.id] %>
      <% @campus_id = campus.id %>
      <% @campus_desc = campus.campus_desc %>

      <div class="campusSemesterStats">
      <p><span class="statsTitle"><%= @campus_desc %> during <%= @semester_selected %></span></p>
      <%= render :partial => "semester_at_a_glance_total" %>
      </div>

    <% end %>

    <p><div class="upLink"><a href="#top">Jump to Top</a></div></p>
  <% end %>
</div>

