<h3>Hi <%= @me.full_name %>,</h3>
<h2>Submit your summer schedule</h2>
<br/>

<% form_for [@me, @summer_report] do |f| %>

  <br/>
  <%= f.error_messages %>
  <br/>
  <p>
    <%= f.label :joined_staff %><br />
    <%= f.text_field :joined_staff %>
  </p>
  <p>
    <%= f.label :weeks_of_holiday %><br />
    <%= f.text_field :weeks_of_holiday %>
  </p>


  <br/>
  <br/>
  <h3>MPD</h3>
  <p>
    <%= f.label :monthly_goal %><br />
    <%= f.text_field :monthly_goal %>
  </p>
  <p>
    <%= f.label :monthly_have %><br />
    <%= f.text_field :monthly_have %>
  </p>
  <p>
    <%= f.label :monthly_needed %><br />
    <%= f.text_field :monthly_needed %>
  </p>
  <p>
    <%= f.label :num_weeks_of_mpd %><br />
    <%= f.text_field :num_weeks_of_mpd %>
  </p>
  <p>
    <%= f.label :support_coach %><br />
    <%= f.check_box :support_coach %>
  </p>
  <p>
    <%= f.label :accountability_partner %><br />
    <%= f.text_field :accountability_partner %>
  </p>


  <br/>
  <br/>
  <h3>Schedule</h3>
  <table>
    <tr>
      <th></th>
      <th>Main assignment</th>
      <th>Description</th>
    </tr>

    <% i = 0 %>
    <% report_weeks = @summer_report.summer_report_weeks %>

    <% f.fields_for :summer_report_weeks do |week_f| %>
      <tr>
        <td><%= "#{Date::MONTHNAMES[(report_weeks[i].week.end_date-6.days).month]} #{(report_weeks[i].week.end_date-6.days).day} - #{report_weeks[i].week.end_date.day}" %></td>

        <%= week_f.hidden_field :week_id %>
        <td><%= week_f.collection_select :summer_report_assignment_id, SummerReportAssignment.all, :id, :assignment, {:prompt => true} %></td>
        <td><%= week_f.text_field :description %></td>
      </tr>
      <% i += 1 %>
    <% end %>
  </table>
  <p>
    <%= f.label :notes %><br />
    <%= f.text_area :notes %>
  </p>


  <br/>
  <br/>
  <h3>Approval</h3>
  Who needs to review your summer schedule?<br/>
  Use the search to add at least one person to do the review.<br/>

  <p id="chosenReviewersNames">
    <% @summer_report.summer_report_reviewers.each do |reviewer| %>
      <br/>
      <%= reviewer.person.full_name %>
    <% end %>
  </p>
  <div id="chosenReviewers" style="display:none;">
    <% f.fields_for :summer_report_reviewers do |reviewer_f| %>
      <%= reviewer_f.hidden_field :person_id %>
    <% end %>
  </div>

  <br/>
  <input type="text" id="search_for_reviewers" value=""/>
  <%= link_to_remote "Search", {:url => {:action => "search_for_reviewers"}, :with => "'q=' + $('#search_for_reviewers').attr('value')", :before => "$('#spinner_search').show()", :complete => "$('#spinner_search').hide()"}, {:id => "search_for_reviewers_link"} %>
  &nbsp;<%= spinner('_search') %>
  <div id="search_for_reviewers_results"></div>

  <br/>
  <br/>
  <br/>
  You may only submit your schedule once!
  <br/>
  <br/>
  <p>
    <%= f.submit 'Submit', :class => "action-button" %> <%= spinner('_submit') %>
  </p>
<% end %>



<script type="text/javascript">
  // don't submit form when enter is pressed
  $(window).keypress(function(event){
    if(event.keyCode == 13) {
      event.preventDefault();
      
      if(event.target.id == "search_for_reviewers"){
        $("#search_for_reviewers_link").trigger('click');
      }

      return false;
    }
  });
</script>